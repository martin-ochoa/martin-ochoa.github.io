<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4.An even more efficient version ‚Äì How to ùí´ùî©ùî¨ùî´ùí¶</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./5_Domains.html" rel="next">
<link href="./3_Towards_a_more_efficient_version.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4908c0a427760731c848ee836885f712.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c1f1f89f24f4b159a9bec410f2b3ec6b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-4908c0a427760731c848ee836885f712.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating fullcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./4_An_even_more_efficient_version.html"><span class="chapter-title">4.An even more efficient version</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">How to ùí´ùî©ùî¨ùî´ùí¶</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1.Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_A_first_example.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2.A first example</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_Towards_a_more_efficient_version.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3.Towards a more efficient version</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_An_even_more_efficient_version.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">4.An even more efficient version</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_Domains.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5.Domains</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_Copy_constraints.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6.Copy constraints</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_Towards_ZKP.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7.Towards ZKP</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_Fiat_Shamir.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8.Fiat Shamir</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9_Recap_and_conclusions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9.Recap and conclusions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">4.An even more efficient version</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>To put things into perspective, our latest protocol version requires sharing 6 polynomials of degree at most <span class="math inline">\(d=3\)</span> (quotients are typically shorter), and the validator has to still do at most 3 multiplications per each one of the 3 equality checks. That is a communication cost of about <span class="math inline">\(3*6\)</span> field elements and <span class="math inline">\(3*3\)</span> field element multiplications. In general this would be ca. <span class="math inline">\(d*6\)</span> field elements in communication and <span class="math inline">\(3*d\)</span> field multiplications for the <span class="math inline">\(d\)</span>-th Fibonacci number (rounding this to the number of padded rows as discussed before). This does not seem quite useful given that only about <span class="math inline">\(d\)</span> additions would allows us to compute the <span class="math inline">\(d\)</span>-th Fibonacci number directly!</p>
<p>But there is a goal behind our strategy. Our goal is to make both the communication and the verification constant (<span class="math inline">\(O(1)\)</span>) for circuits with many gates! To achieve this we need a very useful primitive called a Polynomial Commitment Scheme. In particular, we are going to use the method called KZG. This method relies on pairings over elliptic curves and to keep this notebook as lean as possible, we are preparing a separate tutorial on this topic.</p>
<p>In the following we simply recap some fundamental properties of the needed ingredients while keeping our goal on sight.</p>
<p><strong>What do we want to achieve?</strong> In a nutshell what we want to achieve is the following: We want to completely delegate computation of the circuit to the processor, and as before, also the interpolation of the column polynomial and the computation of the quotients. But the twist is, we will not ask for a full copy of a given polynomial <span class="math inline">\(f(x)\)</span>, but just a very short and constant size piece of information that we call a <strong>commitment</strong> <span class="math inline">\(c_f=\textsf{commitment}(f(x))\)</span>. With this commitment, we can at a later stage challenge the validator to evaluate <span class="math inline">\(f(\gamma)=\alpha\)</span>. We will be able to check on our whether indeed <span class="math inline">\(f(\gamma) = \alpha\)</span> by using <span class="math inline">\(\gamma, \alpha\)</span> and the commitment <span class="math inline">\(c_f\)</span> using a function <span class="math inline">\(\textsf{verify}(\alpha,\gamma,c_f)\)</span>.</p>
<p>What this accomplishes:</p>
<ul>
<li>Instead of sharing a <span class="math inline">\(d\)</span>-size vector for each polynomial over the network, we only share two elements: <span class="math inline">\(c_f \in E\)</span>, where <span class="math inline">\(E\)</span> is an elliptic curve, and <span class="math inline">\(\alpha \in \mathbb{F}_p\)</span>.</li>
<li>A malicious or misbehaving processor <span class="math inline">\(P\)</span> cannot adapt to the interactive challenge <span class="math inline">\(\gamma\)</span> since it has already commited to a polynomial before seeing the challenge. This gives the validator confidence that the value was correctly computed.</li>
<li>We can directly perform the constraint checks <span class="math inline">\(f(\gamma)=Q(\gamma) \cdot Z(\gamma)\)</span> in constant time, regardless of the number of gates in the circuit (that is, the polynomial <span class="math inline">\(d\)</span> of the interpolating polynomial). Certainly there are some upper bounds to the size of a circuit and we will come back to this later.</li>
</ul>
<p>Given that by making this protocol more efficient we have to make it more resilient to misbehaving processors, we are going to call <span class="math inline">\(P\)</span> a <em>prover</em> and <span class="math inline">\(V\)</span> a <em>verifier</em> from now on.</p>
<section id="pairings" class="level4">
<h4 class="anchored" data-anchor-id="pairings">Pairings</h4>
<p>The first ingredient for our new protocol version will be a suitable elliptic curve pairing. We will give you some precomputed functions, but you may reconstruct them on your own.</p>
<p>We need a mapping:</p>
<p><span class="math display">\[e: \mathbb{G_1} \times \mathbb{G_2} \to \mathbb{G_t}\]</span></p>
<p>for additive cyclic groups <span class="math inline">\((\mathbb{G_1},+)\)</span> and <span class="math inline">\((\mathbb{G_2},+)\)</span> and multiplicative <span class="math inline">\((\mathbb{G_t},*)\)</span>. Note that typically the first two groups are additive (since they are subgroups of an elliptic curve) and the destination group is multiplicative (usually defined over a field).</p>
<p>The mapping <span class="math inline">\(e\)</span> we are looking for is ‚Äúbilinear‚Äù, that means:</p>
<p><span class="math display">\[e(P + P', Q) = e(P,Q)*e(P',Q)\]</span> <span class="math display">\[e(P,Q+Q')=e(P,Q)*e(P,Q')\]</span></p>
<p>To construct <strong>secure</strong> pairings, it is important to chose the groups in a particular way which motivates choosing isomorphic but disjoint <span class="math inline">\(\mathbb{G_1},\mathbb{G_2}\)</span> which can be found as subgroups of an elliptic curve over a finite field extension <span class="math inline">\(E(\mathbb{F}_{q^k})\)</span> and <span class="math inline">\(\mathbb{G_t}\)</span> a subgroup of <span class="math inline">\(\mathbb{F^*}_{q^k}\)</span>. We are not going to explain this in more depth but if you are curious check <a href="https://static1.squarespace.com/static/5fdbb09f31d71c1227082339/t/5ff394720493bd28278889c6/1609798774687/PairingsForBeginners.pdf">Pairings for Beginners by Craig Costello</a>.</p>
<div id="d56dfb6f-8ea9-404a-8423-9bd24747eede" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> kzg</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> e(P,Q):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Base field for BN254</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> <span class="dv">21888242871839275222246405745257275088696311157297823662689037894645226208583</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Number of points on BN254</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> Integer(<span class="dv">21888242871839275222246405745257275088548364400416034343698204186575808495617</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="dv">6</span><span class="op">*</span><span class="bu">pow</span>(<span class="dv">4965661367192848881</span>,<span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> P.ate_pairing(Q, n, k, t,q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="598ab309-c1b1-424c-9c3a-9f95db60c03b" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> kzg.P</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> kzg.Q</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>show(<span class="st">"P:"</span>,P)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>show(<span class="st">"Q:"</span>,Q)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>show(e(P,Q))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
\(\displaystyle \verb|P:| \left(1 : 2 : 1\right)\)
</div>
<div class="cell-output cell-output-display">
\(\displaystyle \verb|Q:| \left(\left(11559732032986387107991004021392285783925812861821192530917403151452391805634 ubar + 10857046999023057135944570762232829481370756359578518086990519993285655852781\right) wbar^{2} : \left(4082367875863433681332203403145435568316851327593401208105741076214120093531 ubar + 8495653923123431417604973247489272438418190587263600148770280649306958101930\right) wbar^{3} : 1\right)\)
</div>
<div class="cell-output cell-output-display">
\(\displaystyle \left(15485169958187804055419367470727586316504614054038886924834910714644298081076 ubar + 14110042394329134992063060126132667374513734777529849604059403292605387766763\right) wbar^{5} + \left(17576687079377474679994084448626848766364851367692113922904391421785791556046 ubar + 15263055409656443157285976462204135910932331054849227253916602565546649989931\right) wbar^{4} + \left(1451055192040231810539564576166577843622781952620338854414099592814058446945 ubar + 19362144781956138062795090409372908218130916662778620452325203445403259212772\right) wbar^{3} + \left(7786695150901409298856750468044088494675441502192568573069643047819302766865 ubar + 16893543948180465298099197784510869270928575391710795413610320310782594693022\right) wbar^{2} + \left(8339301614695659949019663159218383351646785965635781625471751346963751888108 ubar + 465898347631256865746797445390333094396673986355153352843254722736295902148\right) wbar + 15780004297944302906621723394852439600559246581555156000423333429824441348714 ubar + 17296046054077859324401147072502722261136321305912126349272372680482680769943\)
</div>
</div>
<p><strong>Exercise 4</strong> Check that the provided <span class="math inline">\(e\)</span> function is bilinear by randomly sampling an integer <span class="math inline">\(s\)</span> and multiplying over the additive subgroups:</p>
<p><span class="math display">\[ e([s]\cdot P,Q)=e(P,[s] \cdot Q)=e(P,Q)^s\]</span></p>
<div id="27a54bc0-cae5-409e-a116-e7f419da23dd" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Solve here!</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>s<span class="op">=</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="kzg-commitment" class="level4">
<h4 class="anchored" data-anchor-id="kzg-commitment">KZG commitment</h4>
<p>Our goal is to leverage pairings to help provers to <em>commit</em> to a polynomial <span class="math inline">\(f(x)\)</span> before receiving the challenge <span class="math inline">\(\gamma\)</span> and for the verifier to have (cryptographic) certainty that the evaluation <span class="math inline">\(f(\gamma)\)</span> was done on this same commited polynomial, ruling out adaptive attacks. There are several answers in the literature to solve this exact problem, one prominent one is the <a href="https://www.iacr.org/archive/asiacrypt2010/6477178/6477178.pdf">KZG commitment scheme</a>. We can illustrate the protocol with the following sequence diagram.</p>
<center>
<img src="img_td/kzg.png" width="300">
<figcaption>
<b>Figure 3</b>: The KZG commitment scheme.
</figcaption>
</center>
<p><br></p>
<p><strong>Exercise 5</strong> For this protocol to work, we need a trusted setup based on a uniformly random (and secret) <em>toxic waste</em> œÑ. This is called toxic waste since it must be deleted after some setup values have been computed with it in order for the protocol to be secure. We also need to declare a public maximum polynomial degree <span class="math inline">\(l\)</span>. Since we will later commit to multiplication of low degree polynomials, let us pick <span class="math inline">\(l=10\)</span>.</p>
<p>With example <span class="math inline">\(\tau=424242\)</span>, compute two public parameters: a vector <span class="math display">\[S_1 = [  P, \tau \cdot P , \tau^2 \cdot P , \cdots,  \tau^{l} \cdot P]\]</span></p>
<p>where <span class="math inline">\(P\)</span> is the generator of <span class="math inline">\(\mathbb{G}_1\)</span> and a value <span class="math display">\[S_2 = \tau \cdot Q\]</span> where <span class="math inline">\(Q\)</span> is the generator of the group <span class="math inline">\(\mathbb{G}_2\)</span>.</p>
<div id="f5e7325f" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Solve here!</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>œÑ <span class="op">=</span> <span class="dv">424242</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>l<span class="op">=</span><span class="dv">10</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>S1<span class="op">=</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>S2<span class="op">=</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If computed correctly you should get:</p>
<p><span class="math display">\[
\begin{aligned}
S_1 = \Big[ &amp;\left(1 : 2 : 1\right), \\
&amp;\left(3388106087484702502772161951837520865682365219266094058038991331506090320735 : 10310862820936104897688292475187545406556140958479334534497508049176340462168 : 1\right), \\
&amp;\left(5786299459695789788261684662131390109566181344091061986154006773045920884529 : 18198083969462810098554436542449595852850793038741994323649111219383738839374 : 1\right), \\
&amp;\left(5932386722799341949736906223819928737327798404444018663115122905353930163217 : 17316789122660091087982740003020863959605853926224865905583913597777031548221 : 1\right), \\
&amp;\left(14603143723753528702641274659350642057392810682423113693594196367092666272615 : 17734357240639322091230265203514580412414342326449923671483947891721675198742 : 1\right), \\
&amp;\left(1485870938289488242176031429247482114928668541241910486620153058173498550422 : 8975504733770431670587733015492501696212039808343155103983507429794936273090 : 1\right), \\
&amp;\left(35087711382470900519387874116184362249603265567233267930080986182721755391 : 9687295787051875541592859447450503637855174457649076441192556983747473888473 : 1\right), \\
&amp;\left(21100087779353388367643433264506322944085867030119306347233967681812330825611 : 17068231115940713163151138839050846284784298672314356795840059410045954257490 : 1\right), \\
&amp;\left(10641104735982477671491147382199353108251699282959504595440637553392719424596 : 3033897669229592557681916129851961240665115699542840722127903032620063452401 : 1\right), \\
&amp;\left(12461517031230393262909098092888598630825065680164551109453025306556394017248 : 11406184524960241674372900569663181593279300027508257400554857135388045542548 : 1\right), \\
&amp;\left(2310703006113265329769149621286389443406062880925858119855767049953176497692 : 20254007398902051444166009223523085479917136359422165955249757385592434525697 : 1\right)
\Big]
\end{aligned}
\]</span></p>
<p>and:</p>
<p><span class="math display">\[
\begin{aligned}
S_2 = \big( &amp;
\big(18178798121214140434976027337622332703345638858169149597321922257824015358086\, \bar{u} + \\
&amp;\quad 17892288729126503148648989889095246645011224085306750203724686651395006961383\big) \bar{w}^2 \; : \\
&amp;\big(15251007341879318938631029793693405432107362852215428951388705343135014132495\, \bar{u} + \\
&amp;\quad 11565079700697045165214936027269859661189920603201791930010463312628382919842\big) \bar{w}^3 \; : \\
&amp;1
\big)
\end{aligned}
\]</span></p>
<center>
<img src="img_td/sendcommitment.png" width="300">
</center>
<p><br></p>
<p><strong>Exercise 6</strong> Implement a <em>commitment</em> function. This function takes as parameters the public vector <span class="math inline">\(S_1\)</span> we computed before and the polynomial <span class="math inline">\(p(x)\)</span> we want to commit to. It then computes <span class="math display">\[\sum_{i=0}^{l} a_i \cdot S_1[i] \]</span></p>
<p>Note that by construction this is:</p>
<p><span class="math display">\[a_0 \cdot P + a_1 \cdot \tau \cdot P + a_2 \cdot \tau^2 \cdot P  + \cdots + a_{l} \cdot \tau^{l} \cdot P \]</span></p>
<p>which is equivalent to:</p>
<p><span class="math display">\[p(\tau) \cdot P\]</span></p>
<p>Note that this will be a point on the curve <span class="math inline">\(EK\)</span>. Test your function over the polynomial <span class="math inline">\(a(x)\)</span> of the Fibonacci example.</p>
<div id="b302ee82" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> commitment(S1,p):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Solve here!</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If computed correctly, you should get a commitment:</p>
<p><span class="math display">\[
\begin{aligned}
c = \big( &amp;
19772988533509128204934208855583299243034568734268587639600165428945857082832 \; : \\
&amp;21198549198844316278609987090510616007059968516882705878791833422348082226388 \; : \\
&amp;1 \big)
\end{aligned}
\]</span></p>
<p>Now this commitment <span class="math inline">\(c\)</span> can be given to the verifier before any challenge is issued.</p>
<center>
<img src="img_td/challengephase.png" width="300">
</center>
<p>In a subsequent step, the prover will receive the challenge <span class="math inline">\(\gamma\)</span> from the verifier. They will now give back <span class="math inline">\(f(\gamma)\)</span> but this time also a proof <span class="math inline">\(\pi\)</span> that indeed this is the evaluation of <span class="math inline">\(\gamma\)</span> in the very same polynomial that the prover commited to through <span class="math inline">\(c\)</span>.</p>
<p><strong>Exercise 7</strong> The <span class="math inline">\(\textsf{proof}\)</span> generating function receives two parameters, the vector <span class="math inline">\(S_1\)</span> and a polynomial <span class="math inline">\(Q_c\)</span>. Similar as before, this will compute a point on the curve which is equal to:</p>
<p><span class="math display">\[\pi = b_0 \cdot P + b_1 \cdot \tau \cdot P + b_2 \cdot \tau^2 \cdot P + \cdots + b_{l} \cdot \tau^{l} \cdot P = Q_c(\tau) \cdot P\]</span></p>
<p>where <span class="math inline">\(b_i\)</span> are the coefficients of the polynomial <span class="math inline">\(Q_c\)</span>. Now, the way this polynomial is constructed is essential for the proof:</p>
<p><span class="math display">\[Q_c(x) = \frac{f(x) - f(\gamma)}{x-\gamma} \]</span></p>
<p>Again here we are exploiting the fact that <span class="math inline">\(\gamma\)</span> is a root of <span class="math inline">\(f(x) - f(\gamma)\)</span> therefore this polynomial must be divisible by <span class="math inline">\(x-\gamma\)</span>. Compute the <span class="math inline">\(\texttt{proof}\)</span> function and test it on the <span class="math inline">\(Q_c\)</span> polynomial for the challenge <span class="math inline">\(\gamma = 151515\)</span> and the polynomial <span class="math inline">\(a(x)\)</span>.</p>
<div id="0625803d" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> proof(S1,Qc):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Solve here!</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Given a challenge Œ≥</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>Œ≥ <span class="op">=</span> <span class="dv">151515</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Solve here!</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>Qc<span class="op">=</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>œÄ <span class="op">=</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If computed correctly, the proof obtained from <span class="math inline">\(\texttt{proof}\)</span> when called on <span class="math inline">\(Q_c\)</span> should be:</p>
<p><span class="math display">\[
\begin{aligned}
\pi = \big( &amp;
18427764633036746853571353448280965399000717707037995558464363091930831203059 \; : \\
&amp;15823869948268955546174436172082876809321127559750802916163692992123652869945 \; : \\
&amp;1 \big)
\end{aligned}
\]</span></p>
<p>The value of the polynomial on the challenge point is:</p>
<p><span class="math display">\[a(\gamma) = 1739069066686765\]</span></p>
<center>
<img src="img_td/verificationphase.png" width="300">
</center>
<p>So now the prover, who has issued the challenge <span class="math inline">\(\gamma\)</span>, has both <span class="math inline">\(c\)</span> and <span class="math inline">\(\pi\)</span>. He will use the verification function that takes as parameters <span class="math inline">\(c, \pi, \gamma\)</span> and <span class="math inline">\(b=f(\gamma)\)</span>. We are finally ready to use the pairing. We want to check whether the following values are equal.</p>
<p><span class="math display">\[
{e(\pi, S_2 - \gamma \cdot Q)} \stackrel{?}{=} {e(c- b \cdot P, Q)}
\]</span></p>
<p>The <strong>left-hand side</strong> is:</p>
<p><span class="math display">\[
{e(\pi, S_2 - \gamma \cdot Q)} = e( Q_c(\tau) \cdot P, (\tau - \gamma) \cdot Q)
\]</span></p>
<p>and using bilinearity:</p>
<p><span class="math display">\[
e( Q_c(\tau) \cdot P, (\tau - \gamma) \cdot Q) = e( {Q_c(\tau)\cdot (\tau - \gamma)} \cdot P,  Q)
\]</span></p>
<p>The <strong>right-hand side</strong> is:</p>
<p><span class="math display">\[
{e(c- b \cdot P, Q)} = e(f(\tau) \cdot P - f(\gamma) \cdot P, Q) = e( {(f(\tau) - f(\gamma))} \cdot P, Q)
\]</span></p>
<p>So essentially what the pairing allows us to do is to check:</p>
<p><span class="math display">\[
{f(\tau) - f(\gamma)} \stackrel{?}{=} {Q_c(\tau)\cdot (\tau - \gamma)}
\]</span></p>
<p>which is expected by the construction of <span class="math inline">\(Q_c\)</span>. This is equivalent to checking polynomial equality using the challenge <span class="math inline">\(\tau\)</span>. But remember, nobody knows <span class="math inline">\(\tau\)</span> directly because we deleted it after setup (‚Äútoxic waste‚Äù)!</p>
<p><strong>Exercise 8</strong> Implement a <span class="math inline">\(\textsf{verification}\)</span> function that takes <span class="math inline">\(c,\pi,\gamma\)</span> and <span class="math inline">\(f(\gamma)=b\)</span> as parameters. It should output true or false, by evaluating:</p>
<p><span class="math display">\[{e(\pi, S_2 - \gamma \cdot Q)} \stackrel{?}{=} {e(c- b \cdot P, Q)}
\]</span></p>
<p>Test the function on the previously computed commitment <span class="math inline">\(c\)</span> for <span class="math inline">\(a(x)\)</span> and the proof <span class="math inline">\(\pi\)</span> computed in the previous exercise.</p>
<div id="750d33ae" class="cell" data-editable="true" data-quarto-private-1="{&quot;key&quot;:&quot;slideshow&quot;,&quot;value&quot;:{&quot;slide_type&quot;:&quot;&quot;}}" data-tags="[]">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verification(c,œÄ,Œ≥,b):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Solve here!</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(verification(c,œÄ,Œ≥,b)) <span class="co">#should return True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="new-protocol-version" class="level4">
<h4 class="anchored" data-anchor-id="new-protocol-version">New Protocol Version</h4>
<p>We divide the protocol into <strong>Setup</strong>, <strong>Prover Computation</strong>, <strong>Verifier Challenge</strong>, and <strong>Proof &amp; Verification</strong> phases.</p>
</section>
<section id="setup-phase" class="level4">
<h4 class="anchored" data-anchor-id="setup-phase">1. Setup Phase</h4>
<ol type="1">
<li><em>(Both)</em> Agree on the public parameters <span class="math inline">\((S_1, S_2)\)</span>.</li>
<li><em>(Verifier)</em> Publicly specifies the maximum polynomial degree <span class="math inline">\(d\)</span>, if needed.</li>
<li><em>(Trusted Ceremony / Setup)</em> Generates a secret <span class="math inline">\(\tau\)</span> and produces <span class="math inline">\((S_1, S_2)\)</span>.<br>
After this step, <span class="math inline">\(\tau\)</span> (the toxic waste) must be discarded to maintain security.</li>
</ol>
</section>
<section id="prover-computation-phase" class="level4">
<h4 class="anchored" data-anchor-id="prover-computation-phase">2. Prover Computation Phase</h4>
<ol type="1">
<li><em>(Prover)</em> Interpolates the column polynomials <span class="math inline">\(a(x), b(x), c(x)\)</span>.</li>
<li><em>(Prover)</em> Constructs quotient polynomials <span class="math inline">\(Q(x), Q_1(x), Q_2(x)\)</span> with respect to the vanishing polynomials <span class="math inline">\(Z(x), Z_1(x)\)</span>.</li>
<li><em>(Prover)</em> Commits to each polynomial by computing <span class="math display">\[
c_a = \text{commit}(a), \quad
c_b = \text{commit}(b), \quad
c_c = \text{commit}(c), \quad
c_Q = \text{commit}(Q), \quad \dots
\]</span> and sends these commitments to the Verifier.</li>
</ol>
</section>
<section id="verifier-challenge-phase" class="level4">
<h4 class="anchored" data-anchor-id="verifier-challenge-phase">3. Verifier Challenge Phase</h4>
<ol type="1">
<li><em>(Verifier)</em> Samples random challenges <span class="math inline">\(\gamma_1, \gamma_2, \gamma_3\)</span>.</li>
<li><em>(Verifier)</em> Sends the challenges to the Prover.</li>
</ol>
</section>
<section id="proof-verification-phase" class="level4">
<h4 class="anchored" data-anchor-id="proof-verification-phase">4. Proof &amp; Verification Phase</h4>
<ol type="1">
<li><p><em>(Prover)</em> Evaluates each committed polynomial at its corresponding challenge. For example, <span class="math display">\[
a(\gamma_1), \quad b(\gamma_1), \quad c(\gamma_1), \quad Q(\gamma_1).
\]</span> Then constructs proofs <span class="math inline">\(\pi_a, \pi_b, \pi_c, \pi_Q\)</span> via the KZG evaluation method. The Prover sends <span class="math display">\[
\bigl(a(\gamma_1),\,b(\gamma_1),\,c(\gamma_1),\,Q(\gamma_1)\bigr)
\]</span> and <span class="math display">\[
(\pi_a,\,\pi_b,\,\pi_c,\,\pi_Q)
\]</span> to the Verifier.</p></li>
<li><p><em>(Verifier)</em> Uses the commitments <span class="math inline">\((c_a,\,c_b,\,c_c,\,c_Q)\)</span> and the proofs <span class="math inline">\(\pi_a, \pi_b, \pi_c, \pi_Q\)</span> to verify each polynomial evaluation.<br>
It then checks the constraint <span class="math display">\[
a(\gamma_1) + b(\gamma_1) - c(\gamma_1)
  \;=\; Q(\gamma_1)\,\cdot Z(\gamma_1).
\]</span> Since the Verifier can construct <span class="math inline">\(Z(x)\)</span> itself, it only needs to check <span class="math inline">\(t(\gamma_1) = Q(\gamma_1)\,Z(\gamma_1)\)</span>, where <span class="math inline">\(t(x)= qL(x) \cdot a(x) + qR(x) \cdot b(x) + qM(x) \cdot (a(x) \cdot b(x)) - c(x)\)</span>.</p></li>
<li><p><em>(Verifier)</em> Repeats a similar check for the recursive constraints: <span class="math display">\[
a(\gamma_2 + 1) \;-\; b(\gamma_2) \;=\; Q_1(\gamma_2)\,\cdot Z_1(\gamma_2),
\]</span> <span class="math display">\[
b(\gamma_3 + 1) \;-\; c(\gamma_3) \;=\; Q_2(\gamma_3)\,\cdot Z_1(\gamma_3).
\]</span></p></li>
<li><p><em>(Verifier)</em> If all these checks pass, the Verifier accepts. Otherwise, it rejects.</p></li>
</ol>
<p>As you can see, both the number of message exchanges and the operations performed by the Verifier are now almost constant. In other words, the Verifier can ask the Prover to compute <span class="math inline">\(F_6\)</span> or <span class="math inline">\(F_{1000}\)</span> and still carry out about the same number of computations. The only operation dependent on the number of rows of the circuit on the verifier‚Äôs side is the computation of the vanishing polynomials <span class="math inline">\(Z\)</span> and <span class="math inline">\(Z_1\)</span>.</p>
</section>
<section id="protocol-diagram" class="level4">
<h4 class="anchored" data-anchor-id="protocol-diagram">Protocol Diagram</h4>
<p>The following diagram visually represents the four main phases of the protocol:</p>
<ol type="1">
<li><strong>Phase 1: Setup</strong>
<ul>
<li>Both parties agree on the public parameters <span class="math inline">\((S_1, S_2)\)</span>.<br>
</li>
<li>The Verifier may specify the maximum polynomial degree <span class="math inline">\(d\)</span>.<br>
</li>
<li>A trusted ceremony generates the secret <span class="math inline">\(\tau\)</span>, then discards it, while producing the public parameters <span class="math inline">\((S_1, S_2)\)</span>.</li>
</ul></li>
<li><strong>Phase 2: Prover Computation</strong>
<ul>
<li>The Prover interpolates the circuit columns (e.g., Fibonacci) into polynomials <span class="math inline">\(a(x), b(x), c(x)\)</span>.<br>
</li>
<li>Constructs the quotient polynomials <span class="math inline">\(Q(x), Q_1(x), Q_2(x)\)</span> relative to vanishing polynomials <span class="math inline">\(Z, Z_1\)</span>.<br>
</li>
<li>Commits to these polynomials (e.g., <span class="math inline">\(c_a, c_b, c_c, c_Q, \dots\)</span>) and sends the commitments to the Verifier.</li>
</ul></li>
<li><strong>Phase 3: Verifier Challenge</strong>
<ul>
<li>The Verifier randomly samples challenges <span class="math inline">\(\gamma_1, \gamma_2, \gamma_3\)</span>.<br>
</li>
<li>Sends these challenges to the Prover.</li>
</ul></li>
<li><strong>Phase 4: Proof &amp; Verification</strong>
<ul>
<li>The Prover evaluates each committed polynomial at the corresponding <span class="math inline">\(\gamma\)</span> value and constructs proofs (e.g., <span class="math inline">\(\pi_a, \pi_b\)</span>).<br>
</li>
<li>Sends the polynomial evaluations and proofs to the Verifier.<br>
</li>
<li>The Verifier checks that the evaluations match the commitments, confirming equations like <span class="math display">\[
t(\gamma_1) \;=\; Q(\gamma_1) \cdot Z(\gamma_1).
\]</span></li>
<li>If all checks pass, the Verifier accepts; otherwise, it rejects.</li>
</ul></li>
</ol>
<center>
<img src="img_td/succint2.png" width="500">
</center>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./3_Towards_a_more_efficient_version.html" class="pagination-link" aria-label="3.Towards a more efficient version">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">3.Towards a more efficient version</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./5_Domains.html" class="pagination-link" aria-label="5.Domains">
        <span class="nav-page-text"><span class="chapter-title">5.Domains</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Global Progress Bar Below Sidebar TOC
    const sidebar = document.querySelector('#quarto-sidebar .sidebar-content');
    if (!sidebar) return;
    const bar = document.createElement('div');
    bar.id = 'global-progress-bar';
    sidebar.appendChild(bar);

    const links = Array.from(document.querySelectorAll('#quarto-sidebar .sidebar-item a[href]'));
    const paths = links.map(a => new URL(a.href).pathname);
    const current = window.location.pathname;
    const idx = paths.indexOf(current);
    if (idx >= 0 && links.length) {
        bar.style.width = ((idx + 1) / links.length * 100) + '%';
    }
});
</script>




</body></html>